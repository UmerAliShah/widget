<!DOCTYPE html>
<html>
  <head>
    <title>Parent Page</title>
    <link href="../src/App.css" />
  </head>

  <body>
    <h1>Parent Page</h1>
    <iframe
      style="
        position: fixed;
        width: 10%;
        height: 70px;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        background-color: transparent;
        border: none;
      "
      id="donationWidget"
      src="http://localhost:3000/"
      title="Widget IFrame"
    ></iframe>
    <table>
      <thead>
        <tr>
          <th>Organization</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody id="donationTableBody"></tbody>
    </table>

    <script>
      // document.addEventListener("DOMContentLoaded", function() {
      //     var receivedData = [];
      //     console.log(receivedData, "coming from widget");

      //     function handleMessage(event) {
      //         console.log(event, "widget handle");

      //         var donationData = event.data.donationData;
      //         receivedData = donationData;
      //         updateTable();
      //     }
      //     /*
      //     function handleIframeLoad() {
      //         var iframe = document.getElementById("widgetFrame");
      //         var message = { type: "INITIALIZE" };
      //         iframe.contentWindow.postMessage(message, "http://localhost:3000/");
      //     }
      //     */

      //     function updateTable() {
      //         var tableBody = document.getElementById("donationTableBody");
      //         tableBody.innerHTML = "";

      //         receivedData.forEach(function(donation, index) {
      //             var row = document.createElement("tr");
      //             var organizationCell = document.createElement("td");
      //             organizationCell.textContent = donation.organization;
      //             var amountCell = document.createElement("td");
      //             amountCell.textContent = "$" + donation.amount;

      //             row.appendChild(organizationCell);
      //             row.appendChild(amountCell);
      //             tableBody.appendChild(row);
      //         });
      //     }

      //     window.addEventListener("message", handleMessage);
      //     //handleIframeLoad();
      //     /*
      //     window.addEventListener("beforeunload", function() {
      //         window.removeEventListener("message", handleMessage);
      //     });
      //     */
      // });
    </script>
    <script>
        window.onload = function () {
	var iframeWin = document.getElementById("da-iframe").contentWindow,
		form = document.getElementById("the-form"),
		myMessage = document.getElementById("my-message");

	myMessage.select();

	form.onsubmit = function () {
		iframeWin.postMessage(myMessage.value, "https://donation-widget.vercel.app/");
		return false;
	};
};
    //   window.addEventListener("message", function (event) {
    //       console.log(event, "hello");
    //     if (event.origin !== "https://donation-widget.vercel.app/") return;
    //   });
      //   function handleLocalStorageChange() {}
      //   window.onstorage = () => {
      //     console.log('worked')
      //     var donationWidget = document.getElementById("donationWidget");
      //     var showModal = localStorage.getItem("modal") === "true";
      //     console.log(showModal, "showModal");
      //     if (showModal) {
      //       donationWidget.style.width = "30%";
      //       donationWidget.style.height = "550px";
      //     } else {
      //       donationWidget.style.width = "10%";
      //       donationWidget.style.height = "70px";
      //     }
      //   };
      //   window.addEventListener("storage", handleLocalStorageChange);

      //   handleLocalStorageChange();
    </script>
  </body>
</html>
